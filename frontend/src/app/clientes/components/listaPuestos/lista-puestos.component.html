<div class="main-container">
  <div class="container-custom">
    <!-- Header -->
    <div class="page-header">
      <h1 class="page-title">Gestión de Puestos de Estacionamiento</h1>
      <p class="page-subtitle">Administre y consulte el estado de los puestos de estacionamiento</p>
    </div>

    <!-- Alerta de criterio de búsqueda -->
    <div *ngIf="criterioBusqueda" class="alert alert-info alert-custom">
      <i class="fas fa-info-circle"></i>
      Resultados de búsqueda: <strong>{{ criterioBusqueda }}</strong>
      <button class="btn btn-sm btn-outline-info ms-2" (click)="cargarPuestos()">
        <i class="fas fa-times"></i> Limpiar filtro
      </button>
    </div>

    <!-- Estadísticas rápidas -->
    <div class="stats-section">
      <div class="stat-card-small">
        <i class="fas fa-parking"></i>
        <div>
          <h4>{{ puestosFiltrados.length }}</h4>
          <small>Total mostrados</small>
        </div>
      </div>
      <div class="stat-card-small">
        <i class="fas fa-check-circle"></i>
        <div>
          <h4>{{ getCountByEstado('DISPONIBLE') }}</h4>
          <small>Disponibles</small>
        </div>
      </div>
      <div class="stat-card-small">
        <i class="fas fa-car"></i>
        <div>
          <h4>{{ getCountByEstado('OCUPADO') }}</h4>
          <small>Ocupados</small>
        </div>
      </div>
      <div class="stat-card-small">
        <i class="fas fa-lock"></i>
        <div>
          <h4>{{ getCountByEstado('BLOQUEADO') }}</h4>
          <small>Bloqueados</small>
        </div>
      </div>
    </div>

    <!-- Tabla de puestos -->
    <div class="table-section">
      <div class="section-header">
        <h3>Lista de Puestos ({{ puestosFiltrados.length }})</h3>
        <div>
          <button class="btn btn-secondary btn-sm" (click)="cargarPuestos()" title="Actualizar">
            <i class="fas fa-sync-alt"></i> Actualizar
          </button>
        </div>
      </div>

      <div class="table-card">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th width="80px">ID</th>
                <th width="100px">Número</th>
                <th width="120px">Tipo</th>
                <th width="120px">Estado</th>
                <th>Ubicación</th>
                <th width="150px">Usuario</th>
                <th width="180px" class="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let puesto of puestosFiltrados" class="puesto-row">
                <td class="fw-bold text-primary">{{ puesto.id }}</td>
                <td>
                  <span class="badge puesto-numero">{{ puesto.numero }}</span>
                </td>
                <td>
                  <span class="badge tipo-badge"
                        [style.background-color]="getTipoColor(puesto.tipoPuesto)"
                        [style.color]="getTextColor(getTipoColor(puesto.tipoPuesto))">
                    {{ getTipoDescripcion(puesto.tipoPuesto) }}
                  </span>
                </td>
                <td>
                  <span class="badge estado-badge"
                        [style.background-color]="getEstadoColor(puesto.estadoPuesto)"
                        [style.color]="getTextColor(getEstadoColor(puesto.estadoPuesto))">
                    <i [class]="getEstadoIcon(puesto.estadoPuesto)"></i>
                    {{ getEstadoDescripcion(puesto.estadoPuesto) }}
                  </span>
                </td>
                <td>
                  <span class="ubicacion-text">{{ puesto.ubicacion }}</span>
                </td>
                <td>
                  <span *ngIf="puesto.usuarioOcupante" class="fw-bold usuario-ocupante">
                    <i class="fas fa-user"></i> {{ puesto.usuarioOcupante }}
                  </span>
                  <span *ngIf="!puesto.usuarioOcupante" class="text-muted">
                    <i class="fas fa-user-slash"></i> Libre
                  </span>
                </td>
                <td class="action-buttons">
                  <!-- Puestos Disponibles -->
                  <div *ngIf="puesto.estadoPuesto === 'DISPONIBLE'" class="action-buttons">
                    <button (click)="ocuparPuesto(puesto.id)"
                            class="btn btn-success btn-sm"
                            title="Ocupar puesto">
                      <i class="fas fa-parking"></i>
                    </button>
                    <button (click)="bloquearPuesto(puesto.id)"
                            class="btn btn-secondary btn-sm"
                            title="Bloquear puesto">
                      <i class="fas fa-lock"></i>
                    </button>
                    <button (click)="ponerEnMantenimiento(puesto.id)"
                            class="btn btn-warning btn-sm"
                            title="Poner en mantenimiento">
                      <i class="fas fa-tools"></i>
                    </button>
                    <button [routerLink]="['/puestos/historial', puesto.id]"
                            class="btn btn-info btn-sm"
                            title="Ver historial">
                      <i class="fas fa-history"></i>
                    </button>
                  </div>

                  <!-- Puestos Ocupados -->
                  <div *ngIf="puesto.estadoPuesto === 'OCUPADO'" class="action-buttons">
                    <button (click)="liberarPuesto(puesto.id)"
                            class="btn btn-warning btn-sm"
                            title="Liberar puesto">
                      <i class="fas fa-sign-out-alt"></i>
                    </button>
                    <button (click)="ponerEnMantenimiento(puesto.id)"
                            class="btn btn-warning btn-sm"
                            title="Poner en mantenimiento">
                      <i class="fas fa-tools"></i>
                    </button>
                    <button [routerLink]="['/puestos/historial', puesto.id]"
                            class="btn btn-info btn-sm"
                            title="Ver historial">
                      <i class="fas fa-history"></i>
                    </button>
                  </div>

                  <!-- Puestos Bloqueados -->
                  <div *ngIf="puesto.estadoPuesto === 'BLOQUEADO'" class="action-buttons">
                    <button (click)="desbloquearPuesto(puesto.id)"
                            class="btn btn-info btn-sm"
                            title="Desbloquear puesto">
                      <i class="fas fa-unlock"></i>
                    </button>
                    <button (click)="ponerEnMantenimiento(puesto.id)"
                            class="btn btn-warning btn-sm"
                            title="Poner en mantenimiento">
                      <i class="fas fa-tools"></i>
                    </button>
                    <button [routerLink]="['/puestos/historial', puesto.id]"
                            class="btn btn-info btn-sm"
                            title="Ver historial">
                      <i class="fas fa-history"></i>
                    </button>
                  </div>

                  <!-- Puestos en Mantenimiento -->
                  <div *ngIf="puesto.estadoPuesto === 'MANTENIMIENTO'" class="action-buttons">
                    <button (click)="desbloquearPuesto(puesto.id)"
                            class="btn btn-success btn-sm"
                            title="Liberar de mantenimiento">
                      <i class="fas fa-check"></i>
                    </button>
                    <button [routerLink]="['/puestos/historial', puesto.id]"
                            class="btn btn-info btn-sm"
                            title="Ver historial">
                      <i class="fas fa-history"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Mensaje cuando no hay puestos -->
        <div *ngIf="puestosFiltrados.length === 0 && !cargando" class="empty-state">
          <i class="fas fa-inbox"></i>
          <h4>No hay puestos para mostrar</h4>
          <p>No se encontraron puestos con los criterios actuales</p>
          <button (click)="cargarPuestos()" class="btn btn-primary">
            <i class="fas fa-refresh"></i> Recargar todos los puestos
          </button>
        </div>

        <!-- Indicador de carga -->
        <div *ngIf="cargando" class="loading-state">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p>Cargando puestos...</p>
        </div>
      </div>
    </div>

    <!-- Botones de navegación -->
    <div class="navigation-buttons">
      <button (click)="volverAInicio()" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Volver al Inicio
      </button>
      <button routerLink="/puestos/buscar" class="btn btn-info">
        <i class="fas fa-search"></i> Búsqueda Avanzada
      </button>
      <button routerLink="/puestos/estadisticas" class="btn btn-primary">
        <i class="fas fa-chart-bar"></i> Ver Estadísticas
      </button>
    </div>
  </div>

  <footer class="footer">
    © 2025 UCAB Montalbán - Sistema de Estacionamiento
  </footer>
</div>
