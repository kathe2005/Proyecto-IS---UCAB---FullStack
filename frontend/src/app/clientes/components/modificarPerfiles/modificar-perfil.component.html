<div id="ContenedorMain">
  <div id="contenedor">
    <!-- Header -->
    <div class="header-section">
      <h1 class="titulo-principal">Sistema de Gestión de Estacionamiento</h1>
      <p class="subtitulo">Universidad Católica Andrés Bello - UCAB Montalbán</p>
    </div>

    <!-- Título de la sección -->
    <div class="section-title">
      <h2>Modificar Perfiles de Clientes</h2>
      <p>Busque y seleccione un cliente para modificar sus datos</p>
    </div>

    <!-- Mensajes de resultado -->
    <div *ngIf="mensaje" [class]="'alert alert-' + mensajeTipo" class="alert">
      <i class="fas fa-info-circle"></i> {{ mensaje }}
    </div>

    <!-- Filtros -->
    <div class="card filters-card">
      <div class="card-content">
        <h4 class="filters-title">
          <i class="fas fa-filter"></i> Filtros de Búsqueda
        </h4>
        <div class="filters-row">
          <div class="filter-group">
            <label class="filter-label">
              <i class="fas fa-search"></i> Buscar por cédula, nombre o apellido
            </label>
            <input type="text"
                   [(ngModel)]="filtroTexto"
                   class="form-control"
                   placeholder="Ej: 12345678, Juan, Pérez..."
                   (input)="aplicarFiltros()">
          </div>

          <div class="filter-group">
            <label class="filter-label">
              <i class="fas fa-tag"></i> Filtrar por Tipo
            </label>
            <select [(ngModel)]="filtroTipo" class="form-control select-control" (change)="aplicarFiltros()">
              <option *ngFor="let tipo of tiposPersona" [value]="tipo.value">
                {{ tipo.label }}
              </option>
            </select>
          </div>

          <div class="filter-actions">
            <button type="button"
                    (click)="limpiarFiltros()"
                    class="btn btn-outline-secondary">
              <i class="fas fa-times"></i> Limpiar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Lista de clientes -->
    <div class="card section-card">
      <div class="card-content">
        <div class="icono">
          <i class="fas fa-users"></i>
        </div>
        <div class="texto">
          <h3>Clientes Registrados</h3>
          <p>Seleccione un cliente para modificar sus datos</p>
        </div>
      </div>
    </div>

    <!-- Resultados -->
    <div class="results-section">
      <div class="results-header">
        <h3>Resultados ({{ clientesFiltrados.length }})</h3>
      </div>

      <!-- Loading state -->
      <div *ngIf="cargando" class="loading-state">
        <div class="loading-content">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Cargando clientes...</p>
        </div>
      </div>

      <!-- Lista de clientes -->
      <div *ngIf="!cargando" class="clientes-list">
        <div *ngFor="let cliente of clientesFiltrados" class="cliente-card">
          <div class="cliente-header">
            <div class="cliente-info">
              <h4>{{ cliente.nombre }} {{ cliente.apellido }}</h4>
              <p class="cliente-cedula">Cédula: {{ cliente.cedula }}</p>
            </div>
            <div class="cliente-badges">
              <!-- CORREGIDO: Usar tipoPersona en lugar de tipoCliente -->
              <span class="badge" [class]="cliente.tipoPersona === 'UCAB' ? 'badge-primary' : 'badge-warning'">
                {{ cliente.tipoPersona || 'VISITANTE' }}
              </span>
              <!-- CORREGIDO: Mostrar estado o 'ACTIVO' por defecto -->
              <span class="badge badge-success">
                {{ cliente.estado || 'ACTIVO' }}
              </span>
            </div>
          </div>
          <div class="cliente-details">
            <p><i class="fas fa-envelope"></i> {{ cliente.email || 'No especificado' }}</p>
            <p><i class="fas fa-phone"></i> {{ cliente.telefono || 'No especificado' }}</p>
            <p><i class="fas fa-user"></i> Usuario: {{ cliente.usuario }}</p>
            <p><i class="fas fa-calendar"></i> Registrado: {{ cliente.fechaRegistro || 'No disponible' }}</p>
          </div>
          <div class="cliente-actions">
            <button class="btn btn-primary" (click)="modificarCliente(cliente)">
              <i class="fas fa-edit"></i> Modificar
            </button>
          </div>
        </div>
      </div>

      <!-- Mensaje cuando no hay resultados -->
      <div *ngIf="clientesFiltrados.length === 0 && !cargando" class="no-results">
        <div class="empty-content">
          <i class="fas fa-search"></i>
          <h3>No se encontraron clientes</h3>
          <p>No hay clientes que coincidan con los filtros aplicados.</p>
        </div>
      </div>
    </div>

    <!-- MODAL DE EDICIÓN -->
    <div *ngIf="mostrarFormulario" class="modal-overlay" (click)="cerrarFormulario()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>
            <i class="fas fa-edit"></i> Modificar Cliente: {{ clienteEditado?.nombre }} {{ clienteEditado?.apellido }}
          </h3>
          <button class="close-btn" (click)="cerrarFormulario()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">
          <!-- Mensajes de error -->
          <div *ngIf="errorMensaje" class="alert alert-danger">
            <i class="fas fa-exclamation-circle"></i> {{ errorMensaje }}
          </div>

          <!-- Mensaje de éxito -->
          <div *ngIf="mensajeExito" class="alert alert-success">
            <i class="fas fa-check-circle"></i> {{ mensajeExito }}
          </div>

          <!-- Formulario -->
          <form (ngSubmit)="guardarCambios()">
            <div class="form-grid">
              <!-- Información básica -->
              <div class="form-group">
                <label for="cedula"><i class="fas fa-id-card"></i> Cédula *</label>
                <input type="text" id="cedula" [(ngModel)]="clienteEditado.cedula"
                       name="cedula" class="form-control" [disabled]="true">
                <small class="form-text">La cédula no se puede modificar.</small>
              </div>

              <div class="form-group">
                <label for="usuario"><i class="fas fa-user"></i> Usuario *</label>
                <input type="text" id="usuario" [(ngModel)]="clienteEditado.usuario"
                       name="usuario" class="form-control" [disabled]="true">
                <small class="form-text">El usuario no se puede modificar.</small>
              </div>

              <div class="form-group">
                <label for="nombre"><i class="fas fa-user"></i> Nombre *</label>
                <input type="text" id="nombre" [(ngModel)]="clienteEditado.nombre"
                       name="nombre" class="form-control" required>
              </div>

              <div class="form-group">
                <label for="apellido"><i class="fas fa-user"></i> Apellido *</label>
                <input type="text" id="apellido" [(ngModel)]="clienteEditado.apellido"
                       name="apellido" class="form-control" required>
              </div>

              <!-- Contacto -->
              <div class="form-group">
                <label for="email"><i class="fas fa-envelope"></i> Email *</label>
                <input type="email" id="email" [(ngModel)]="clienteEditado.email"
                       name="email" class="form-control" required>
                <small class="form-text">Formato: ejemplo@dominio.com</small>
              </div>

              <div class="form-group">
                <label for="telefono"><i class="fas fa-phone"></i> Teléfono</label>
                <input type="text" id="telefono" [(ngModel)]="clienteEditado.telefono"
                       name="telefono" class="form-control"
                       placeholder="0426-1234567">
                <small class="form-text">Formato: 0426-6112225</small>
              </div>

              <!-- Tipo de persona -->
              <div class="form-group">
                <label for="tipoPersona"><i class="fas fa-tag"></i> Tipo de Persona *</label>
                <select id="tipoPersona" [(ngModel)]="clienteEditado.tipoPersona"
                        name="tipoPersona" class="form-control" required>
                  <option value="UCAB">UCAB</option>
                  <option value="VISITANTE">Visitante</option>
                </select>
              </div>

              <!-- Dirección -->
              <div class="form-group">
                <label for="direccion"><i class="fas fa-map-marker-alt"></i> Dirección</label>
                <input type="text" id="direccion" [(ngModel)]="clienteEditado.direccion"
                       name="direccion" class="form-control">
              </div>

              <!-- Cambio de contraseña (opcional) -->
              <div class="form-group full-width">
                <h4><i class="fas fa-lock"></i> Cambiar Contraseña (Opcional)</h4>
                <div class="password-grid">
                  <div class="form-group">
                    <label for="contrasena">Nueva Contraseña</label>
                    <input type="password" id="contrasena" [(ngModel)]="clienteEditado.contrasena"
                           name="contrasena" class="form-control"
                           placeholder="Dejar vacío para no cambiar">
                    <small class="form-text">Mínimo 8 caracteres, con mayúscula y número</small>
                  </div>

                  <div class="form-group">
                    <label for="confirmarContrasena">Confirmar Contraseña</label>
                    <input type="password" id="confirmarContrasena"
                           [(ngModel)]="clienteEditado.confirmarContrasena"
                           name="confirmarContrasena" class="form-control">
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cancelarSeleccion()" [disabled]="guardando">
            <i class="fas fa-times"></i> Cancelar
          </button>
          <button type="button" class="btn btn-primary" (click)="guardarCambios()" [disabled]="guardando">
            <span *ngIf="!guardando">
              <i class="fas fa-save"></i> Guardar Cambios
            </span>
            <span *ngIf="guardando">
              <i class="fas fa-spinner fa-spin"></i> Guardando...
            </span>
          </button>
        </div>
      </div>
    </div>

    <!-- Botón de volver -->
    <div class="actions-section">
      <button class="btn btn-secondary" (click)="volverAGestion()">
        <i class="fas fa-arrow-left"></i> Volver a Gestión de Perfiles
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    © 2025 UCAB Montalbán - Sistema de Estacionamiento
  </footer>
</div>
